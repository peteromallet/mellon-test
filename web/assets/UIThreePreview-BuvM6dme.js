import{r as l,j as t,C as f,O as v,E as j,g as S,h as b,M as d,D as i,i as M,k as z,l as k,m as y}from"./three-fiber-rAbmj7-d.js";import{u as w,c as E,S as C,B as h,a as L}from"./index-BJucMZdw.js";function D(c,a,o,s){let n;switch(c){case"phong":n=new y({color:16777215,wireframe:a,flatShading:!o,shininess:100,specular:4473924,side:i});break;case"lambert":n=new k({color:16777215,wireframe:a,flatShading:!o,side:i});break;case"normal":n=new z({wireframe:a,flatShading:!o,side:i});break;case"toon":n=new M({color:16777215,wireframe:a,side:i,map:s instanceof d?s.map:null,normalMap:s instanceof d?s.normalMap:null});break;case"metal":n=new d({color:16777215,metalness:1,roughness:.1,wireframe:a,flatShading:!o,side:i,envMapIntensity:1.5});break;default:n=new d({color:16777215,wireframe:a,flatShading:!o,roughness:.5,metalness:.1,side:i})}return n}function $({url:c,wireframe:a,shaded:o,materialType:s}){const[n,u]=l.useState(null),{scene:r}=S(c,void 0,void 0,e=>{e instanceof Error&&(console.log("Error loading 3d model",e.message),u(e))});return n||!r?null:(l.useEffect(()=>{console.log("scene",r),r.traverse(e=>{e.isMesh&&(console.log("mesh",e),e.userData.originalMaterial=e.material,console.log("child material",e.material))})},[r]),l.useEffect(()=>{r.traverse(e=>{e.isMesh&&e.material&&(s==="original"?(e.material=e.userData.originalMaterial,e.material.flatShading=!o,e.material.wireframe=a):e.material=D(s,a,o,e.userData.originalMaterial),e.material.needsUpdate=!0,e.geometry&&(e.geometry.computeVertexNormals(),e.geometry.attributes.normal.needsUpdate=!0))})},[a,o,s]),t.jsx(b,{children:t.jsx("primitive",{object:r})}))}function N({value:c,...a}){const o=w(m=>m.transform[2]),[s,n]=l.useState(!1),[u,r]=l.useState(!1),[e,x]=l.useState("original"),p=768*o,g=c[0]?.url;return t.jsxs("div",{style:{position:"relative",width:"768px",height:"768px",overflow:"hidden"},...a,children:[t.jsx("div",{style:{position:"absolute",top:0,left:0,transform:`scale(${1/o})`,transformOrigin:"top left",width:`${p}px`,height:`${p}px`},children:t.jsxs(f,{style:{background:"#333333",width:"100%",height:"100%"},resize:{scroll:!1,debounce:{scroll:50,resize:0}},camera:{position:[0,0,5]},dpr:2,children:[t.jsx("ambientLight",{intensity:.25}),t.jsx("directionalLight",{position:[5,5,5],intensity:1}),t.jsx("directionalLight",{position:[-5,0,-5],intensity:.25}),g&&t.jsx($,{url:`http://${E.serverAddress}${g}`,wireframe:s,shaded:u,materialType:e}),t.jsx(v,{enableDamping:!0,target:[0,0,0],dampingFactor:.05}),t.jsx(j,{preset:"warehouse",background:!1})]})}),t.jsxs(C,{direction:"row",spacing:1,sx:{position:"absolute",top:10,left:10,zIndex:1},children:[t.jsx(h,{variant:s?"contained":"outlined",color:"secondary",size:"small",onClick:()=>n(!s),sx:{fontSize:"11px","&.MuiButton-outlined":{color:"#999999"}},children:"Wireframe"}),t.jsx(h,{variant:u?"contained":"outlined",color:"secondary",size:"small",onClick:()=>r(!u),sx:{fontSize:"11px","&.MuiButton-outlined":{color:"#999999"}},children:"Smooth shading"}),t.jsxs(L,{value:e,onChange:m=>x(m.target.value),size:"small",native:!0,sx:{fontSize:"12px",width:"120px",backgroundColor:"rgba(0, 0, 0, 0.2)"},children:[t.jsx("option",{value:"original",children:"Original"}),t.jsx("option",{value:"standard",children:"Standard"}),t.jsx("option",{value:"phong",children:"Phong"}),t.jsx("option",{value:"lambert",children:"Lambert"}),t.jsx("option",{value:"normal",children:"Normal"}),t.jsx("option",{value:"toon",children:"Toon"}),t.jsx("option",{value:"metal",children:"Metal"})]})]})]})}export{N as default};
